# Задание

## Part 1
На Python + FastAPI реализовать REST эндпоинты для работы с заявками на участие в конференции: 
- `GET /conferences/{conference_id}/applications` - получение списка заявок, поданных пользователем;
- `POST /conferences/{conference_id}/applications` - добавление новой заявки на участие в конференции;
- `PATCH /conferences/{conference_id}/applications/{application_id}` - редактирование ранее поданной заявки;
- `DELETE /conferences/{conference_id}/applications/{application_id}` - удаление заявки.

В качестве базы данных (хранилища) заявок на участие в конференции используется таблица Google.Sheets, с которой необходимо работать через [Google Sheets API](https://developers.google.com/sheets/api/guides/concepts). Структура таблицы соответствует описанию входных данных в разделе про эндпоинт "GET /conferences/{conference_id}/applications". Для каждой конференции создается отдельная гугл-таблица.

Также имеется еще одна таблица, в которой содержится информация о списке конференций. Полученный в запросе параметр `{conference_id}` используется для поиска в этой таблице нужной конференции. Если конференция найдена, из соответствующей записи извлекается идентификатор гугл-таблицы с информацией о заявках на участие и дальнейшая работа ведется с этой конференцией. Если конференция не найдена, все эндпоинты возвращают ошибку 404. Если конференция найдена, но срок приема заявок уже прошел, все эндпоинты возвращают ошибку 403. Подробнее см. #2 .

## GET /conferences/{conference_id}/applications
### Входные данные (параметры запроса)
В запросе должен быть обязательно указан один из следующих параметров, но не два или три одновременно:
- email, 
- telegram_id, 
- discord_id.

Значение входного параметра используется для фильтрации (поиска) докладов в гугл-таблице. 

### Выходные данные
JSON-список `[{"id": 1, ...}, {"id": 2, ...}, ...]`, содержащий найденные записи. Формат отдельной записи в списке соответствует следующему JSON;
```json
{
  "id": 1,
  "telegram_id": "1234", 
  "discord_id": "4321", 
  "submitted_at": "2023-07-15T13:23:53.697941+03:00", 
  "updated_at": "2023-07-15T13:23:53.697941+03:00", 
  "email": "example@example.com", 
  "phone": "+79001234567", 
  "name": "Иван", 
  "surname": "Иванов", 
  "patronymic": "Иванович", 
  "university": "ГУАП", 
  "student_group": "4031", 
  "applicant_role": "студент", 
  "title": "Название работы, подаваемой на конференцию", 
  "adviser": "проф. Сидоров А.В.", 
  "coauthors": [
    {"name": "Петр", "surname": "Петров", "patronymic": "Петрович"}, 
    {"name": "Ноунейм", "surname": "Аноним", "patronymic": "Ноунеймович"}, 
    ...
  ]
} 
```
В  поле `"id"` содержится порядковый номер строки в таблице (уникальный идентификатор заявки).
Поле `"submitted_at"` хранит дату подачи заявки в формате [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601), в Python можно использовать `datetime.datetime.now().astimezone().isoformat()`.
Поле `"updated_at"` хранит дату последнего изменения заявки в том же формате ISO 8601.

Если найденных записей нет, возвращается ошибка 404.

### Примеры
```
/applications?telegram_id="1234"
/applications/?email="example@example.com"
```

## POST /conferences/{conference_id}/applications
### Входные данные (тело запроса)
JSON, структура которого приведена в описании эндпоинта "GET /applications". 

### Логика работы
Полученные данные добавляются в конец таблицы Google.Sheets. Поля `"id"`, `"telegram_id"`, `"discord_id"`, `"phone"`, `"coauthors"`, `"student_group"`, `"submitted_at"`, `"updated_at"` являются необязательными. В случае отсутствия в теле запроса любого из остальных полей должно генерироваться сообщение об ошибке с правильным HTTP кодом в соответствии с подходом REST. Значения полей `"id"`, `"submitted_at"` и `"updated_at"`, даже если они указаны, игнорируются.

### Выходные данные
В случае успешной записи в таблицу эндпоинт возвращает JSON, аналогичный поданному на вход, но с обязательными полями: 
- `"id"`, в котором содержится порядковый номер добавленной в таблицу строки; 
- `"submitted_at"`, в котором содержатся дата и время получения заявки;
- `"updated_at", в котором содержится та же дата и время получения заявки (при создании заявки дата ее создания и дата последнего обновления совпадают)`. 
Если во входных данных были указаны эти три поля, их значения перезаписываются.

## PATCH  /conferences/{conference_id}/applications/{application_id}
### Входные данные (тело запроса)
JSON, структура которого приведена в описании эндпоинта "GET /applications". При этом все поля являются необязательными.

### Логика работы
В таблице ищется запись с указанными `{application_id}` и делается проверка совпадения "telegram_id" в таблице и в поступивших на вход эндпоинта данных в JSON (если поле `"telegram_id"` во входном JSON отсутствует/не указано, то проверка осуществляется по `"discord_id"`; если `"discord_id"` тоже отсутствует, то проверка не пройдена). Если запись найдена и проверка пройдена, в этой записи замещаются все поля, присутствующие во входных данных, кроме полей `"telegram_id"`, `"discord_id"`, `"id"`, `"submitted_at"`, `"updated_at"`. Поля, отсутствующие во входных данных, не изменяются. В поле `"updated_at"` в обязательном порядке записывается текущая дата и время, см. пример кода выше, значение поля `"submitted_at"` при этом **не изменяется**. 

Если запись с нужным id не найдена, возвращается HTTP код 404. Если запись найдена, но проверка совпадения "telegram_id"/"discord_id" не пройдена, возвращается HTTP 403.

### Выходные данные
JSON, структура которого приведена в описании эндпоинта "GET /applications", включая поле `"id"` и все остальные поля записи, в т.ч. и те, которые не были изменены данным запросом.


### DELETE  /conferences/{conference_id}/applications/{application_id}
### Входные данные (тело запроса)
JSON, содержащий одно из полей `"telegram_id"`, `"discord_id"` или `"email"`.

### Логика работы
Удаляет запись с соответствующим id (проверяется значение входного параметра адресной строки `{application_id}`), если в запросе правильно указано значение поля `"telegram_id"`, `"discord_id"` или `"email"` для этой записи. Если записи с таким id и значением второго поля нет, возвращает ошибку 404.

### Выходные данные
JSON, структура которого приведена в описании эндпоинта "GET /applications", включая поле `"id"` и все без исключения поля удаленной записи.

## Part 2
# Задание

На Python + FastAPI реализовать REST эндпоинты для работы со списком конференций: 
- `GET /conferences` - получение списка конференций;
- `GET /conferences/{conference_id}`- получение полной информации о конференции;
- `POST /conferences` - добавление новой заявки на участие в конференции;
- `PUT /conferences/{conference_id}` - редактирование ранее созданной конференции.

В качестве базы данных (хранилища) перечня конференций используется таблица Google.Sheets, с которой необходимо работать через [Google Sheets API](https://developers.google.com/sheets/api/guides/concepts). Структура таблицы (столбцы):
- идентификатор (число) конференции (можно опустить, если он совпадает с номером строки в таблице);
- идентификатор (строка) отдельной гугл-таблицы, в которой будет храниться информация об участниках конференции (см. #1 );
- полное название конференции на русском (напр., "76-я международная студенческая научная конференция ГУАП");
- короткое название конференции на русском (напр., "МСНК 2023");
- полное название конференции на английском (не обязательное поле);
- короткое название конференции на английском (не обязательное поле);
- название организации, проводящей конференцию; 
- дата начала приема заявок на участие в конференции;
- дата окончания приема заявок на участие в конференции;
- дата начала приема статей/докладов для публикации;
- дата окончания приема статей/докладов для публикации;
- дата начала проведения конференции;
- дата завершения конференции;
- URL сайта конференции (не обязательное поле);
- электронная почта для связи с организаторами.

## GET /conferences
### Входные данные (параметры запроса)
Параметр `filter`,  используется для фильтрации (поиска) конференций в гугл-таблице. Может принимать следующие значения:
- `all` - в выдачу должны включаться все имеющиеся в гугл-таблице конференции;
- `active` - в выдачу должны включаться все конференции, по которым в данный момент идет прием заявок на участие (значение по умолчанию);
- `past` - в выдачу должны включаться все конференции, срок приема заявок по которым уже прошел;
- `future` - в выдачу должны включаться все конференции, срок начала приема заявок по которым еще не наступил.

### Выходные данные
JSON-список, содержащий короткую информацию о найденных конференциях. Если найденных записей нет, возвращается пустой список `[]`.
Формат возвращаемого json:
```json
[
  {
    "id": 1,
    "name_rus_short": "Короткое название конференции на русском",
    "name_eng_short": "Короткое название конференции на английском",
    "conf_start_date": "Дата начала проведения конференции",
    "conf_end_date": "Дата завершения конференции"
  }
]
```

### Примеры обращения к эндпоинту
```
/conferences
/conferences?filter="past"
/conferences/?filter="future"
```

## GET /conferences/{conference_id}
### Входные данные (URL)
Параметр `{conference_id}` (число) - идентификатор конференции.

### Логика работы
В гугл-таблице осуществляется поиск конференции с указанным идентификатором. Если найдена, возвращается вся информация о ней. Если не найдена, возвращается ошибка 404.

### Выходные данные
JSON, содержащий полную информацию о найденной конференции, включая ее id. Пример:
```json
{
  "id": 2, // conference_id
  "name_rus": "76-я международная студенческая научная конференция ГУАП",
  "name_rus_short": "МСНК-2023",
  "name_eng": "",
  "name_eng_short": "",
  "registration_start_date": "20.02.2023", // дата начала приема заявок
  "registration_end_date": "14.04.2023", // дата окончания приема заявок
  "submission_start_date": "01.05.2023", // дата начала приема докладов для публикации
  "submission_end_date": "30.05.2023", // дата окончания приема докладов
  "conf_start_date": "17.04.2023", // дата начала конференции
  "conf_end_date": "21.04.2023", // дата окончания конференции
  "organized_by": "ГУАП", // название организации, проводящей мероприятие
  "url": "https://guap.ru/msnk/",
  "email": "example@example.com"
}
```

Если в запросе имеется заголовок `"Authorization: Bearer {token}"` и указанный в нем токен проходит проверку, в выходной JSON включается дополнительное поле `"google_spreadsheet"`, содержащее строковый идентификатор гугл-таблицы с данными об участниках конференции. Например, : `"google_spreadsheet": "15yVKYIUea6gj2wTWR1ndPzeGENDyBIxo1eHZDkRljUI"`. Если токен не проходит проверку, возвращается ошибка 403.

## POST /conferences
### Входные данные (тело запроса)
JSON, аналогичный тому, что приведен в описании выходных данных эндпоинта `GET /conferences/{conference_id}`, без поля `"id"`, но с полем `"google_spreadsheet"`.
### Логика работы
Проверяется наличие заголовка `"Authorization: Bearer {token}"` в запросе. Если токен валидный, запрос обрабатывается и в таблицу со списком конференций добавляется новая запись. Если токен не валидный или отсутствует заголовок `"Authorization"` - возвращается ошибка 403.
### Выходные данные
В случае успешной записи в таблицу эндпоинт возвращает JSON, аналогичный поданному на вход, но с дополнительным полем `"id"`, в котором содержится порядковый номер добавленной в таблицу строки (т.н. `{conference_id}`).

## PUT /conferences/{conference_id}
### Входные данные (тело запроса)
JSON, аналогичный тому, что приведен в описании выходных данных эндпоинта `GET /conferences/{conference_id}`, без поля `"id"`. Все поля являются необязательными.

### Логика работы
Проверяется наличие заголовка `"Authorization: Bearer {token}"` в запросе. Если токен валидный, запрос обрабатывается и в таблице со списком конференций вносятся изменения в запись с указанным `{conference_id}`. Если токен не валидный или отсутствует заголовок `"Authorization"` - возвращается ошибка 403. Если запись с указанным id конференции в таблице отсутствует, возвращается ошибка 404. Если запись найдена и авторизация пройдена, осуществляется замена значений в таблице на значения в теле запроса. Если какие-то поля с описанием информации о конференции в теле запроса отсутствуют, они в таблице не меняются.

### Выходные данные
В случае отсутствия ошибки: JSON, аналогичный тому, что приведен в описании выходных данных эндпоинта `GET /conferences/{conference_id}`, включая поля `"id"`, `"google_spreadsheet"` и все остальные, в т.ч. и те, которые не были изменены данным запросом.

## Part 3
# Задание

На Python + FastAPI реализовать REST эндпоинты для работы с публикациями участников конференции: 
- `GET /conferences/{conference_id}/publications` - получение списка публикаций, поданных пользователем;
- `GET /conferences/{conference_id}/applications/{application_id}/publication` - получение подробной информации о конкретной публикации;
- `POST /conferences/{conference_id}/applications/{application_id}/publication` - подача новой публикации от участника конференции;
- `PUT /conferences/{conference_id}/applications/{application_id}/publication` - замена (редактирование) файла с текстом публикации;
- `PATCH /conferences/{conference_id}/applications/{application_id}/publication` - внесение изменений в мета-данные публикации.

В качестве базы данных (хранилища) информации о публикациях используется та же таблица Google.Sheets, в которой уже хранятся заявки на участие в конференции (см. #1 ). В таблицу с заявками добавляются дополнительные столбцы и каждая публикация привязывается к одной из ранее созданных заявок.

Также имеется еще одна таблица, в которой содержится информация о списке конференций. Полученный в запросе параметр `{conference_id}` используется для поиска в этой таблице нужной конференции. Если конференция найдена, из соответствующей записи извлекается идентификатор гугл-таблицы с информацией о заявках на участие и дальнейшая работа ведется с этой конференцией. Если конференция не найдена, все эндпоинты возвращают ошибку 404. Если конференция найдена, но срок приема заявок уже прошел, все эндпоинты возвращают ошибку 403. Подробнее см. #2 .

## GET /conferences/{conference_id}/publications
### Входные данные (параметры запроса)
В запросе должен быть обязательно указан один из следующих параметров, но не два или три одновременно:
- email, 
- telegram_id, 
- discord_id.

Значение входного параметра используется для фильтрации (поиска) публикаций в гугл-таблице. 

### Выходные данные
JSON-список `[{"id": 1, ...}, {"id": 2, ...}, ...]`, содержащий найденные записи. Формат отдельной записи в списке имеет следующий вид:
```json
{
  "id": "application_id", // идентификатор публикации совпадает с идентификатором заявки, к которой данная публикация привязана
  "publication_title": "Название публикации", // может отличаться от названия доклада в исходной заявке
  "upload_date": "дата загрузки", 
  "review_status": "статус рецензирования" // одно из значений "in progress", "changes requested", "rejected", "accepted"
}
```
Если поле `"upload_date"` в гугл-таблице не заполнено (пустая строка), соответствующая запись не включается в выходные данные. Если найденных записей нет или у всех найденных записей пустое поле `"upload_date"`, возвращается ошибка 404.

### Примеры запросов
```
/conferences/3/publications?telegram_id="1234"
/conferences/1/publications/?email="example@example.com"
```

## GET /conferences/{conference_id}/applications/{application_id}/publication
### Входные данные (параметры запроса)
В запросе должен быть обязательно указан один из следующих параметров, но не два или три одновременно:
- email, 
- telegram_id, 
- discord_id.

Значение входного параметра используется для проверки прав доступа к публикации в гугл-таблице. 

### Логика работы
Осуществляется поиск заявки с идентификатором `{application_id}` в гугл-таблице. Если заявка не найдена, возвращается ошибка 404. Если заявка найдена, проверяется значение поля `"email"`, `"telegram_id"` или `"discord_id"`, в зависимости от того, какое из них было указано во входных данных. Если проверка не пройдена, возвращается ошибка 403. Если проверка пройдена успешно, возвращается подробная информация о публикации.

### Выходные данные
JSON следующего вида:
```json
{
  "id": "application_id", // идентификатор публикации совпадает с идентификатором заявки, к которой данная публикация привязана
  "publication_title": "Название публикации", // может отличаться от названия доклада в исходной заявке
  "upload_date": "дата загрузки", 
  "review_status": "статус рецензирования", // одно из значений "in progress", "changes requested", "rejected", "accepted"
  "download_url": "URL для скачивания",
  "keywords": "список; ключевых; слов; через; точу с запятой",
  "abstract": "аннотация к статье"
}
```


## POST /conferences/{conference_id}/applications/{application_id}/publication
### Входные данные (тело запроса)
В теле запроса передаются: 
- обязательное поле `"publication_title"`;
- обязательно одно (и только одно) из полей `"email"`, `"telegram_id"`, `"discord_id"`;
- необязательные поля `"keywords"` и `"abstract"`;
- бинарный документ (файл) с текстом публикации. 
Можно, например, использовать формат `multipart/form-data` (multipart HTTP request) для передачи файла и метаданных в одном запросе.

### Логика работы
Осуществляется поиск заявки с идентификатором `{application_id}` в гугл-таблице. Если заявка не найдена, возвращается ошибка 404. Если заявка найдена, проверяется значение поля `"email"`, `"telegram_id"` или `"discord_id"`, в зависимости от того, какое из них было указано во входных данных. Если проверка не пройдена, возвращается ошибка 403. 

Если проверка пройдена успешно, файл с текстом публикации загружается в отдельную директорию на гугл-диск (см. официальную [документацию](https://developers.google.com/drive/api/guides/manage-uploads) или [пример](https://www.projectpro.io/recipes/upload-files-to-google-drive-using-python) с использованием сторонней библиотеки `pydrive`). В гугл-таблице обновляются значения полей `"publication_title"`, `"keywords"`, `"abstract"`, если они были переданы во входных данных. В поле `"upload_date"` записываются текущая дата и время в формате [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601), в Python можно использовать код `datetime.datetime.now().astimezone().isoformat()`. В поле `"review_status"` записывается значение `"in progress"`. В поле `"download_url"` помещается URL для скачивания файла.

### Выходные данные
JSON, структура которого приведена в разделе "Выходные данные" эндпоинта "GET /conferences/{conference_id}/applications/{application_id}/publication", содержащий актуальную информацию о публикации.


## PUT /conferences/{conference_id}/applications/{application_id}/publication
### Входные данные (тело запроса)
Бинарный документ (файл) с текстом публикации

### Входные данные (параметры запроса)
В запросе должен быть обязательно указан один из следующих параметров, но не два или три одновременно:
- email, 
- telegram_id, 
- discord_id.

Значение входного параметра используется для проверки прав доступа к публикации в гугл-таблице. 

### Логика работы
Осуществляются проверки, аналогичные описанным для эндпоинта POST /conferences/{conference_id}/applications/{application_id}/publication. Если они пройдены успешно, переданный в теле запроса файл загружается на гугл-диск, а в гугл-таблице обновляются поля `"upload_date"` и `"download_url"`. В поле `"review_status"` записывается значение `"in progress"`.

### Выходные данные
JSON, структура которого приведена в разделе "Выходные данные" эндпоинта "GET /conferences/{conference_id}/applications/{application_id}/publication", содержащий актуальную информацию о публикации.


## PATCH /conferences/{conference_id}/applications/{application_id}/publication
### Входные данные (тело запроса)
JSON, в котором содержатся:
- обязательно одно (и только одно) из полей `"email"`, `"telegram_id"`, `"discord_id"`;
- необязательные поля `"publication_title"`, `"keywords"` и `"abstract"`;

### Логика работы
Осуществляются проверки, аналогичные описанным для эндпоинта POST /conferences/{conference_id}/applications/{application_id}/publication. Если они пройдены успешно, в гугл-таблице обновляются значения полей `"publication_title"`, `"keywords"`, `"abstract"`, если они были переданы во входных данных.

### Выходные данные
JSON, структура которого приведена в разделе "Выходные данные" эндпоинта "GET /conferences/{conference_id}/applications/{application_id}/publication", содержащий актуальную информацию о публикации.

## Part 4
# Задание

На Python + FastAPI реализовать REST эндпоинты для работы с информацией об авторах публикаций: 
- `GET /conferences/{conference_id}/applications/{application_id}/authors` - получение списка авторов публикации;
- `POST /conferences/{conference_id}/applications/{application_id}/authors` - добавление нового автора публикации;
- `PATCH /conferences/{conference_id}/applications/{application_id}/authors/{author_id}` - редактирование информации об уже имеющемся авторе публикации;
- `DELETE /conferences/{conference_id}/applications/{application_id}/authors/{author_id}` - удаление информации об авторе.

В качестве базы данных (хранилища) информации об авторах публикаций используется отдельный лист (вкладка) с названием "Авотры" в таблице Google.Sheets, которая используется в #1 и #3 . Структура данных на этом листе соответствует описанию входных данных в разделе про эндпоинт "GET /conferences/{conference_id}/applications/{application_id}/authors". 

Также имеется еще одна таблица, в которой содержится информация о списке конференций. Полученный в запросе параметр `{conference_id}` используется для поиска в этой таблице нужной конференции. Если конференция найдена, из соответствующей записи извлекается идентификатор гугл-таблицы с информацией о заявках на участие и дальнейшая работа ведется с этой конференцией. Если конференция не найдена, все эндпоинты возвращают ошибку 404. Если конференция найдена, но срок приема заявок уже прошел, все эндпоинты возвращают ошибку 403. Подробнее см. #2 .


## GET /conferences/{conference_id}/applications/{application_id}/authors
### Входные данные (параметры запроса)
В запросе должен быть обязательно указан один из следующих параметров, но не два или три одновременно:
- email, 
- telegram_id, 
- discord_id.

Значение входного параметра используется для фильтрации (поиска) публикаций в гугл-таблице. 

### Выходные данные
JSON-список `[{"id": 1, ...}, {"id": 2, ...}, ...]`, содержащий найденные записи. Формат отдельной записи в списке имеет следующий вид:
```json
{
  "id": "author_id", // идентификатор автора в общем списке всех авторов, зарегистрированных на конференции
  "application_id": "application_id", // идентификатор заявки на участие в конференции
  "name": "Имя автора",
  "surname": "Фамилия автора",
  "patronymic": "Отчество автора (при наличии)",
  "email": "example@example.com",
  "phone": "+79876543210",
  "bio": "биография автора",
  "organization": "Санкт-Петербургский государственный университет аэрокосмического приборостроения",
  "role": "Старшний научный сотрудник"
}
```

### Примеры запросов
```
/conferences/3/applications/14/authors?telegram_id="1234"
/conferences/1/applications/7/authors/?email="example@example.com"
```
